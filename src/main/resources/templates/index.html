<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}">Game Daemon Deck</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/bootstrap-icons/bootstrap-icons.min.css">
    <style>
        body {
            background-color: #f8f9fa; /* Light gray background */
        }
        .card-header-blue {
            background-color: #007bff; /* Bootstrap primary blue */
            color: white;
            font-weight: bold;
            height: 50px; /* Specific height */
            display: flex;
            align-items: center;
            padding-left: 1rem;
        }
        .card-header-green {
            background-color: #28a745; /* Bootstrap success green */
            color: white;
            font-weight: bold;
            height: 50px; /* Specific height */
            display: flex;
            align-items: center;
            padding-left: 1rem;
        }
        .card-header-grey {
            background-color: #6c757d; /* Bootstrap secondary grey */
            color: white;
            font-weight: bold;
            height: 50px; /* Specific height */
            display: flex;
            align-items: center;
            padding-left: 1rem;
        }
        .btn-teal {
            background-color: #20c997; /* Bootstrap info teal */
            color: white;
        }
        .btn-teal:hover {
            background-color: #17a2b8; /* Darker teal/blue on hover */
            color: white;
        }
        /* Custom styles for dashed border card */
        .dashed-card {
            border: 2px dashed #6c757d; /* Gray dashed border */
            text-align: center;
            padding: 2rem;
            height: 100%; /* Ensure it takes full height of parent */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .dashed-card .bi {
            font-size: 4rem; /* Large icon size */
            color: #6c757d;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .gdd-logo-circle {
            width: 30px; /* Enforce square shape */
            height: 30px; /* Enforce square shape */
            display: flex; /* Use flexbox for centering content */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom border-light"> <!-- Changed to light background, removed navbar-dark, added light gray bottom border -->
            <div class="container-fluid">
                <a class="navbar-brand d-flex align-items-center" href="/"> <!-- Added d-flex align-items-center for vertical alignment -->
                    <span class="p-1 me-2 gdd-logo-circle" style="background-color: #007bff; border-radius: 50%;"> <!-- Blue circle background -->
                        <img src="/static/bootstrap-icons/controller.svg" alt="GDD Logo" width="20" height="20" class="d-inline-block" style="filter: invert(100%);"> <!-- White icon -->
                    </span>
                    <strong class="text-black">Game Daemon Deck</strong> <!-- Bold and black text -->
                </a>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active text-dark" aria-current="page" href="/">Dashboard</a> <!-- Changed text color to dark -->
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" href="#">Logs</a> <!-- Changed text color to dark -->
                        </li>
                    </ul>
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="btn btn-outline-secondary d-flex align-items-center text-dark" href="/settings"> <!-- Changed text color to dark -->
                                <i class="bi bi-gear me-1"></i> Settings
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Header -->
        <div class="container mt-4">
            <div class="row justify-content-center">
                <div class="col-lg-12 text-center">
                    <h1 class="display-4">Welcome to Game Daemon Deck!</h1>
                    <p class="lead">Your game server manager is up and running.</p>
                </div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="container mt-4">
            <div class="row">
                <!-- Left Column (col-lg-8) -->
                <div class="col-lg-8">
                    <div class="row">
                        <!-- Server Cards -->
                        <div th:each="server : ${servers}" class="col-md-6 mb-4">
                            <div class="card shadow-sm h-100">
                                <div class="card-header d-flex justify-content-between" th:style="'background-color:' + ${server.headerColor} + '; color:' + ${server.fontColor}">
                                    <span th:text="${server.name}">Server Name</span>
                                    <a href="#" class="btn btn-sm" th:style="'color:' + ${server.fontColor}"><i class="bi bi-gear"></i></a>
                                </div>
                                <div class="card-body">
                                    <p class="card-text" th:text="'AppID: ' + ${server.appId}">AppID: N/A</p>
                                    <p class="card-text" th:text="'Game: ' + ${server.pluginName}">Game: N/A</p>
                                    <p class="card-text">Status:
                                        <span th:if="${server.running}" class="text-success"><i class="bi bi-circle-fill"></i> Running</span>
                                        <span th:unless="${server.running}" class="text-danger"><i class="bi bi-circle-fill"></i> Stopped</span>
                                    </p>
                                    <div class="d-flex justify-content-between">
                                        <button class="btn btn-sm btn-primary">Start</button>
                                        <button class="btn btn-sm btn-danger">Stop</button>
                                        <button class="btn btn-sm btn-teal">Update</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Add Server Placeholder -->
                        <div class="col-md-6 mb-4">
                            <div class="card dashed-card shadow-sm h-100">
                                <i class="bi bi-plus-circle"></i>
                                <h5 class="mt-3">Add New Server</h5>
                                <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addServerModal">Add Server</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column (col-lg-4) -->
                <div class="col-lg-4">
                    <!-- Quick Actions Card -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-header card-header-grey">Quick Actions</div>
                        <div class="card-body d-grid gap-2">
                            <button class="btn btn-primary">Reload All Servers</button>
                            <button class="btn btn-primary">Invalidate Caches</button>
                        </div>
                    </div>
                    <!-- System Info Card -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-header card-header-grey">System Information</div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">System Health: <span class="badge bg-success">Good</span></li>
                                <li class="list-group-item">Uptime: <span>5 days</span></li>
                                <li class="list-group-item">Last Backup: <span>Yesterday</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Server Modal -->
    <div class="modal fade" id="addServerModal" tabindex="-1" aria-labelledby="addServerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addServerModalLabel">Add New Server</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="/servers" method="post">
                        <div id="addServerError" class="alert alert-danger" style="display: none;"></div>
                        <div class="mb-3">
                            <label for="serverName" class="form-label">Server Name</label>
                            <input type="text" class="form-control" id="serverName" name="serverName" required>
                        </div>
                        <div class="mb-3">
                            <label for="appId" class="form-label">AppID</label>
                            <input type="text" class="form-control" id="appId" name="appId">
                        </div>
                        <div class="mb-3">
                            <label for="pluginName" class="form-label">Game</label>
                            <select class="form-select" id="pluginName" name="pluginName">
                                <option th:each="plugin : ${plugins}" th:value="${plugin.name}" th:text="${plugin.name}"></option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="headerColor" class="form-label">Header Color</label>
                            <select class="form-select" id="headerColor" name="headerColor">
                                <option value="blue" selected>Blue</option>
                                <option value="black">Black</option>
                                <option value="white">White</option>
                                <option value="green">Green</option>
                                <option value="red">Red</option>
                                <option value="yellow">Yellow</option>
                                <option value="purple">Purple</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="fontColor" class="form-label">Font Color</label>
                            <select class="form-select" id="fontColor" name="fontColor">
                                <option value="white" selected>White</option>
                                <option value="black">Black</option>
                                <option value="blue">Blue</option>
                                <option value="green">Green</option>
                                <option value="red">Red</option>
                                <option value="yellow">Yellow</option>
                                <option value="purple">Purple</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Server</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="container mt-4">
        <hr class="my-4">
        <p class="text-center text-muted">Â© Charles L. Eakins, 2026</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const error = urlParams.get('error');
            if (error === 'duplicate_server') {
                const serverName = urlParams.get('serverName');
                const appId = urlParams.get('appId');
                const pluginName = urlParams.get('pluginName');
                const headerColor = urlParams.get('headerColor');
                const fontColor = urlParams.get('fontColor');

                document.getElementById('serverName').value = serverName;
                document.getElementById('appId').value = appId;
                document.getElementById('pluginName').value = pluginName;
                document.getElementById('headerColor').value = headerColor;
                document.getElementById('fontColor').value = fontColor;

                const errorDiv = document.getElementById('addServerError');
                errorDiv.textContent = `A server with the name '${serverName}' already exists.`;
                errorDiv.style.display = 'block';
                const addServerModal = new bootstrap.Modal(document.getElementById('addServerModal'));
                addServerModal.show();
            }
        });
    </script>
</body>
</html>